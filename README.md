# Hazelcast Guides Site

The site root of [Hazelcast Guides](https://guides.hazelcast.org) containing the Antora-generated
files and hosted by GitHub Pages.

## Structure

- `docs/`: Contains the files generated by Antora. GitHub Pages site is built from this folder in the master branch.
- `home/`: Contains the home page component where all guides are listed.
- `lib/`: Contains custom Asciidoc extensions.
- `create.sh`: Script to create the pages from scratch by pulling the latest commits of all guide repositories.

## Development

You can preview the changes before publishing a new guide or making some changes to the existing ones. Before adding a 
new guide, make sure the repository has the same file hierarchy as 
[Base Guide](https://github.com/hazelcast-guides/base-guide).

#### 1) Update Antora Playbook

If you create a new guide, then add the new repository to playbook. To see the changes on an existing one, find
the corresponding repository in the playbook and update the url and/or the branch name.

```yaml
- url: https://github.com/changeme/foo.git
  branches: bar
  start_path: doc
```

#### 2) Update Homepage

If you add a new guide, then update `home/modules/ROOT/pages/index.adoc` such that the new guide is placed under an
appropriate section. 

```
[.guide]
=== image:your-framework-logo.png[] xref:<changeme>:ROOT:index.adoc[New Guide Title]

Learn how to ...
```

The `<changeme>` part must be the `name` you set in `doc/antora.yml` of the new guide's
repository.

```yaml
name: guide-name
title: Guide Title
version: master
```

#### 3) Create the Site

```shell script
$ sh create.sh
```

Open `docs/index.html` to preview the changes. Note that, when running locally, some pages are shown in this format:

```
Name        Size            Date Modified
_images/                    1/19/21, 10:23:02 AM
index.html  15.6 kB         1/19/21, 10:28:32 AM
```

Navigate to `index.html`s and continue previewing. This will not be an issue when hosted on GitHub Pages.


## Publishing

#### Editing an Existing Guide

All guides come with a [publisher GitHub action](https://github.com/hazelcast-guides/base-guide/blob/master/.github/workflows/guide-website-update.yml)
which kicks in when a file under `doc/` folder (in guide's repository) is edited. The action runs `create.sh` of this
repository and pushes the latest changes to this repository. Note that this action needs `SECRET_TOKEN` to be added as
a repository secret at guides' repositories.

#### Publishing a New Guide

The publisher action cannot create new files but only change the existing ones (the related issue: [#4](https://github.com/hazelcast-guides/guides-site/issues/4)).
This is a known bug and haven't resolved yet. Hence, if a new guide is to be added, that is, new files to be created in
this repo, then the very first push must be done manually. This is also the case when, let's say, a new image is to be
added to an existing guide. Again, the newly created image file must be pushed manually. In such a case, run `create.sh`
and push the changes. But make sure not to change the content of other guides. 
